(function(){var s=this;var q=s.Backbone;var i=[];var h=i.push;var r=i.slice;var B=i.splice;var d;if(typeof exports!=="undefined"){d=exports}else{d=s.Backbone={}}d.VERSION="0.9.9";var D=s._;if(!D&&(typeof require!=="undefined")){D=require("underscore")}d.$=s.jQuery||s.Zepto||s.ender;d.noConflict=function(){s.Backbone=q;return this};d.emulateHTTP=false;d.emulateJSON=false;var a=/\s+/;var F=function(N,L,H,K){if(!H){return true}if(typeof H==="object"){for(var J in H){N[L].apply(N,[J,H[J]].concat(K))}}else{if(a.test(H)){var M=H.split(a);for(var I=0,G=M.length;I<G;I++){N[L].apply(N,[M[I]].concat(K))}}else{return true}}};var e=function(L,J,H){var K,I=-1,G=J.length;switch(H.length){case 0:while(++I<G){(K=J[I]).callback.call(K.ctx)}return;case 1:while(++I<G){(K=J[I]).callback.call(K.ctx,H[0])}return;case 2:while(++I<G){(K=J[I]).callback.call(K.ctx,H[0],H[1])}return;case 3:while(++I<G){(K=J[I]).callback.call(K.ctx,H[0],H[1],H[2])}return;default:while(++I<G){(K=J[I]).callback.apply(K.ctx,H)}}};var p=d.Events={on:function(G,J,H){if(!(F(this,"on",G,[J,H])&&J)){return this}this._events||(this._events={});var I=this._events[G]||(this._events[G]=[]);I.push({callback:J,context:H,ctx:H||this});return this},once:function(H,K,I){if(!(F(this,"once",H,[K,I])&&K)){return this}var G=this;var J=D.once(function(){G.off(H,J);K.apply(this,arguments)});J._callback=K;this.on(H,J,I);return this},off:function(G,P,H){var M,O,Q,N,L,I,K,J;if(!this._events||!F(this,"off",G,[P,H])){return this}if(!G&&!P&&!H){this._events={};return this}N=G?[G]:D.keys(this._events);for(L=0,I=N.length;L<I;L++){G=N[L];if(M=this._events[G]){Q=[];if(P||H){for(K=0,J=M.length;K<J;K++){O=M[K];if((P&&P!==(O.callback._callback||O.callback))||(H&&H!==O.context)){Q.push(O)}}}this._events[G]=Q}}return this},trigger:function(I){if(!this._events){return this}var H=r.call(arguments,1);if(!F(this,"trigger",I,H)){return this}var J=this._events[I];var G=this._events.all;if(J){e(this,J,H)}if(G){e(this,G,arguments)}return this},listenTo:function(G,H,K){var I=this._listeners||(this._listeners={});var J=G._listenerId||(G._listenerId=D.uniqueId("l"));I[J]=G;G.on(H,K||this,this);return this},stopListening:function(G,H,K){var I=this._listeners;if(!I){return}if(G){G.off(H,K,this);if(!H&&!K){delete I[G._listenerId]}}else{for(var J in I){I[J].off(null,null,this)}this._listeners={}}return this}};p.bind=p.on;p.unbind=p.off;D.extend(d,p);var n=d.Model=function(G,I){var J;var H=G||{};this.cid=D.uniqueId("c");this.changed={};this.attributes={};this._changes=[];if(I&&I.collection){this.collection=I.collection}if(I&&I.parse){H=this.parse(H)}if(J=D.result(this,"defaults")){D.defaults(H,J)}this.set(H,{silent:true});this._currentAttributes=D.clone(this.attributes);this._previousAttributes=D.clone(this.attributes);this.initialize.apply(this,arguments)};D.extend(n.prototype,p,{changed:null,idAttribute:"id",initialize:function(){},toJSON:function(G){return D.clone(this.attributes)},sync:function(){return d.sync.apply(this,arguments)},get:function(G){return this.attributes[G]},escape:function(G){return D.escape(this.get(G))},has:function(G){return this.get(G)!=null},set:function(L,N,K){var G,J;if(L==null){return this}if(D.isObject(L)){J=L;K=N}else{(J={})[L]=N}var H=K&&K.silent;var M=K&&K.unset;if(!this._validate(J,K)){return false}if(this.idAttribute in J){this.id=J[this.idAttribute]}var I=this.attributes;for(G in J){N=J[G];M?delete I[G]:I[G]=N;this._changes.push(G,N)}this._hasComputed=false;if(!H){this.change(K)}return this},unset:function(G,H){return this.set(G,void 0,D.extend({},H,{unset:true}))},clear:function(H){var G={};for(var I in this.attributes){G[I]=void 0}return this.set(G,D.extend({},H,{unset:true}))},fetch:function(H){H=H?D.clone(H):{};if(H.parse===void 0){H.parse=true}var G=this;var I=H.success;H.success=function(L,J,K){if(!G.set(G.parse(L),H)){return false}if(I){I(G,L,H)}};return this.sync("read",this,H)},save:function(M,H,Q){var N,L,I;if(M==null||D.isObject(M)){N=M;Q=H}else{if(M!=null){(N={})[M]=H}}Q=Q?D.clone(Q):{};if(Q.wait){if(N&&!this._validate(N,Q)){return false}L=D.clone(this.attributes)}var J=D.extend({},Q,{silent:true});if(N&&!this.set(N,Q.wait?J:Q)){return false}if(!N&&!this._validate(null,Q)){return false}var K=this;var O=Q.success;Q.success=function(U,R,T){I=true;var S=K.parse(U);if(Q.wait){S=D.extend(N||{},S)}if(!K.set(S,Q)){return false}if(O){O(K,U,Q)}};var G=this.isNew()?"create":(Q.patch?"patch":"update");if(G=="patch"){Q.attrs=N}var P=this.sync(G,this,Q);if(!I&&Q.wait){this.clear(J);this.set(L,J)}return P},destroy:function(H){H=H?D.clone(H):{};var G=this;var K=H.success;var I=function(){G.trigger("destroy",G,G.collection,H)};H.success=function(L){if(H.wait||G.isNew()){I()}if(K){K(G,L,H)}};if(this.isNew()){H.success();return false}var J=this.sync("delete",this,H);if(!H.wait){I()}return J},url:function(){var G=D.result(this,"urlRoot")||D.result(this.collection,"url")||v();if(this.isNew()){return G}return G+(G.charAt(G.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(G){return G},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},change:function(G){var J=this._changing;this._changing=true;var I=this._computeChanges(true);this._pending=!!I.length;for(var H=I.length-2;H>=0;H-=2){this.trigger("change:"+I[H],this,I[H+1],G)}if(J){return this}while(this._pending){this._pending=false;this.trigger("change",this,G);this._previousAttributes=D.clone(this.attributes)}this._changing=false;return this},hasChanged:function(G){if(!this._hasComputed){this._computeChanges()}if(G==null){return !D.isEmpty(this.changed)}return D.has(this.changed,G)},changedAttributes:function(I){if(!I){return this.hasChanged()?D.clone(this.changed):false}var K,J=false,H=this._previousAttributes;for(var G in I){if(D.isEqual(H[G],(K=I[G]))){continue}(J||(J={}))[G]=K}return J},_computeChanges:function(G){this.changed={};var M={};var K=[];var L=this._currentAttributes;var J=this._changes;for(var I=J.length-2;I>=0;I-=2){var H=J[I],N=J[I+1];if(M[H]){continue}M[H]=true;if(L[H]!==N){this.changed[H]=N;if(!G){continue}K.push(H,N);L[H]=N}}if(G){this._changes=[]}this._hasComputed=true;return K},previous:function(G){if(G==null||!this._previousAttributes){return null}return this._previousAttributes[G]},previousAttributes:function(){return D.clone(this._previousAttributes)},_validate:function(I,H){if(!this.validate){return true}I=D.extend({},this.attributes,I);var G=this.validate(I,H);if(!G){return true}if(H&&H.error){H.error(this,G,H)}this.trigger("error",this,G,H);return false}});var E=d.Collection=function(H,G){G||(G={});if(G.model){this.model=G.model}if(G.comparator!==void 0){this.comparator=G.comparator}this._reset();this.initialize.apply(this,arguments);if(H){this.reset(H,D.extend({silent:true},G))}};D.extend(E.prototype,p,{model:n,initialize:function(){},toJSON:function(G){return this.map(function(H){return H.toJSON(G)})},sync:function(){return d.sync.apply(this,arguments)},add:function(G,P){var L,N,I,M,H,O;var J=P&&P.at;var K=((P&&P.sort)==null?true:P.sort);G=D.isArray(G)?G.slice():[G];for(L=G.length-1;L>=0;L--){if(!(M=this._prepareModel(G[L],P))){this.trigger("error",this,G[L],P);G.splice(L,1);continue}G[L]=M;H=M.id!=null&&this._byId[M.id];if(H||this._byCid[M.cid]){if(P&&P.merge&&H){H.set(M.attributes,P);O=K}G.splice(L,1);continue}M.on("all",this._onModelEvent,this);this._byCid[M.cid]=M;if(M.id!=null){this._byId[M.id]=M}}if(G.length){O=K}this.length+=G.length;N=[J!=null?J:this.models.length,0];h.apply(N,G);B.apply(this.models,N);if(O&&this.comparator&&J==null){this.sort({silent:true})}if(P&&P.silent){return this}while(M=G.shift()){M.trigger("add",M,this,P)}return this},remove:function(L,J){var K,G,I,H;J||(J={});L=D.isArray(L)?L.slice():[L];for(K=0,G=L.length;K<G;K++){H=this.get(L[K]);if(!H){continue}delete this._byId[H.id];delete this._byCid[H.cid];I=this.indexOf(H);this.models.splice(I,1);this.length--;if(!J.silent){J.index=I;H.trigger("remove",H,this,J)}this._removeReference(H)}return this},push:function(H,G){H=this._prepareModel(H,G);this.add(H,D.extend({at:this.length},G));return H},pop:function(H){var G=this.at(this.length-1);this.remove(G,H);return G},unshift:function(H,G){H=this._prepareModel(H,G);this.add(H,D.extend({at:0},G));return H},shift:function(H){var G=this.at(0);this.remove(G,H);return G},slice:function(H,G){return this.models.slice(H,G)},get:function(G){if(G==null){return void 0}return this._byId[G.id!=null?G.id:G]||this._byCid[G.cid||G]},at:function(G){return this.models[G]},where:function(G){if(D.isEmpty(G)){return[]}return this.filter(function(H){for(var I in G){if(G[I]!==H.get(I)){return false}}return true})},sort:function(G){if(!this.comparator){throw new Error("Cannot sort a set without a comparator")}if(D.isString(this.comparator)||this.comparator.length===1){this.models=this.sortBy(this.comparator,this)}else{this.models.sort(D.bind(this.comparator,this))}if(!G||!G.silent){this.trigger("sort",this,G)}return this},pluck:function(G){return D.invoke(this.models,"get",G)},update:function(G,P){var N,K,I,H;var O=[],L=[],J={};var M=this.model.prototype.idAttribute;P=D.extend({add:true,merge:true,remove:true},P);if(P.parse){G=this.parse(G)}if(!D.isArray(G)){G=G?[G]:[]}if(P.add&&!P.remove){return this.add(G,P)}for(K=0,I=G.length;K<I;K++){N=G[K];H=this.get(N.id||N.cid||N[M]);if(P.remove&&H){J[H.cid]=true}if((P.add&&!H)||(P.merge&&H)){O.push(N)}}if(P.remove){for(K=0,I=this.models.length;K<I;K++){N=this.models[K];if(!J[N.cid]){L.push(N)}}}if(L.length){this.remove(L,P)}if(O.length){this.add(O,P)}return this},reset:function(J,H){H||(H={});if(H.parse){J=this.parse(J)}for(var I=0,G=this.models.length;I<G;I++){this._removeReference(this.models[I])}H.previousModels=this.models;this._reset();if(J){this.add(J,D.extend({silent:true},H))}if(!H.silent){this.trigger("reset",this,H)}return this},fetch:function(G){G=G?D.clone(G):{};if(G.parse===void 0){G.parse=true}var I=this;var H=G.success;G.success=function(L,J,K){var M=G.update?"update":"reset";I[M](L,G);
if(H){H(I,L,G)}};return this.sync("read",this,G)},create:function(H,G){var J=this;G=G?D.clone(G):{};H=this._prepareModel(H,G);if(!H){return false}if(!G.wait){J.add(H,G)}var I=G.success;G.success=function(L,M,K){if(K.wait){J.add(L,K)}if(I){I(L,M,K)}};H.save(null,G);return H},parse:function(G){return G},clone:function(){return new this.constructor(this.models)},chain:function(){return D(this.models).chain()},_reset:function(){this.length=0;this.models=[];this._byId={};this._byCid={}},_prepareModel:function(I,H){if(I instanceof n){if(!I.collection){I.collection=this}return I}H||(H={});H.collection=this;var G=new this.model(I,H);if(!G._validate(I,H)){return false}return G},_removeReference:function(G){if(this===G.collection){delete G.collection}G.off("all",this._onModelEvent,this)},_onModelEvent:function(I,H,J,G){if((I==="add"||I==="remove")&&J!==this){return}if(I==="destroy"){this.remove(H,G)}if(H&&I==="change:"+H.idAttribute){delete this._byId[H.previous(H.idAttribute)];if(H.id!=null){this._byId[H.id]=H}}this.trigger.apply(this,arguments)}});var z=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortedIndex","toArray","size","first","head","take","initial","rest","tail","last","without","indexOf","shuffle","lastIndexOf","isEmpty"];D.each(z,function(G){E.prototype[G]=function(){var H=r.call(arguments);H.unshift(this.models);return D[G].apply(D,H)}});var j=["groupBy","countBy","sortBy"];D.each(j,function(G){E.prototype[G]=function(J,H){var I=D.isFunction(J)?J:function(K){return K.get(J)};return D[G](this.models,I,H)}});var C=d.Router=function(G){G||(G={});if(G.routes){this.routes=G.routes}this._bindRoutes();this.initialize.apply(this,arguments)};var m=/\((.*?)\)/g;var k=/:\w+/g;var A=/\*\w+/g;var f=/[\-{}\[\]+?.,\\\^$|#\s]/g;D.extend(C.prototype,p,{initialize:function(){},route:function(G,H,I){if(!D.isRegExp(G)){G=this._routeToRegExp(G)}if(!I){I=this[H]}d.history.route(G,D.bind(function(K){var J=this._extractParameters(G,K);I&&I.apply(this,J);this.trigger.apply(this,["route:"+H].concat(J));d.history.trigger("route",this,H,J)},this));return this},navigate:function(H,G){d.history.navigate(H,G);return this},_bindRoutes:function(){if(!this.routes){return}var H,G=D.keys(this.routes);while((H=G.pop())!=null){this.route(H,this.routes[H])}},_routeToRegExp:function(G){G=G.replace(f,"\\$&").replace(m,"(?:$1)?").replace(k,"([^/]+)").replace(A,"(.*?)");return new RegExp("^"+G+"$")},_extractParameters:function(G,H){return G.exec(H).slice(1)}});var b=d.History=function(){this.handlers=[];D.bindAll(this,"checkUrl");if(typeof window!=="undefined"){this.location=window.location;this.history=window.history}};var o=/^[#\/]|\s+$/g;var y=/^\/+|\/+$/g;var l=/msie [\w.]+/;var c=/\/$/;b.started=false;D.extend(b.prototype,p,{interval:50,getHash:function(H){var G=(H||this).location.href.match(/#(.*)$/);return G?G[1]:""},getFragment:function(I,H){if(I==null){if(this._hasPushState||!this._wantsHashChange||H){I=this.location.pathname;var G=this.root.replace(c,"");if(!I.indexOf(G)){I=I.substr(G.length)}}else{I=this.getHash()}}return I.replace(o,"")},start:function(I){if(b.started){throw new Error("Backbone.history has already been started")}b.started=true;this.options=D.extend({},{root:"/"},this.options,I);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var H=this.getFragment();var G=document.documentMode;var K=(l.exec(navigator.userAgent.toLowerCase())&&(!G||G<=7));this.root=("/"+this.root+"/").replace(y,"/");if(K&&this._wantsHashChange){this.iframe=d.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow;this.navigate(H)}if(this._hasPushState){d.$(window).bind("popstate",this.checkUrl)}else{if(this._wantsHashChange&&("onhashchange" in window)&&!K){d.$(window).bind("hashchange",this.checkUrl)}else{if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}}}this.fragment=H;var L=this.location;var J=L.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!J){this.fragment=this.getFragment(null,true);this.location.replace(this.root+this.location.search+"#"+this.fragment);return true}else{if(this._wantsPushState&&this._hasPushState&&J&&L.hash){this.fragment=this.getHash().replace(o,"");this.history.replaceState({},document.title,this.root+this.fragment+L.search)}}if(!this.options.silent){return this.loadUrl()}},stop:function(){d.$(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);b.started=false},route:function(G,H){this.handlers.unshift({route:G,callback:H})},checkUrl:function(H){var G=this.getFragment();if(G===this.fragment&&this.iframe){G=this.getFragment(this.getHash(this.iframe))}if(G===this.fragment){return false}if(this.iframe){this.navigate(G)}this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(I){var H=this.fragment=this.getFragment(I);var G=D.any(this.handlers,function(J){if(J.route.test(H)){J.callback(H);return true}});return G},navigate:function(I,H){if(!b.started){return false}if(!H||H===true){H={trigger:H}}I=this.getFragment(I||"");if(this.fragment===I){return}this.fragment=I;var G=this.root+I;if(this._hasPushState){this.history[H.replace?"replaceState":"pushState"]({},document.title,G)}else{if(this._wantsHashChange){this._updateHash(this.location,I,H.replace);if(this.iframe&&(I!==this.getFragment(this.getHash(this.iframe)))){if(!H.replace){this.iframe.document.open().close()}this._updateHash(this.iframe.location,I,H.replace)}}else{return this.location.assign(G)}}if(H.trigger){this.loadUrl(I)}},_updateHash:function(G,I,J){if(J){var H=G.href.replace(/(javascript:|#).*$/,"");G.replace(H+"#"+I)}else{G.hash="#"+I}}});d.history=new b;var u=d.View=function(G){this.cid=D.uniqueId("view");this._configure(G||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()};var g=/^(\S+)\s*(.*)$/;var w=["model","collection","el","id","attributes","className","tagName","events"];D.extend(u.prototype,p,{tagName:"div",$:function(G){return this.$el.find(G)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();this.stopListening();return this},make:function(H,G,J){var I=document.createElement(H);if(G){d.$(I).attr(G)}if(J!=null){d.$(I).html(J)}return I},setElement:function(G,H){if(this.$el){this.undelegateEvents()}this.$el=G instanceof d.$?G:d.$(G);this.el=this.$el[0];if(H!==false){this.delegateEvents()}return this},delegateEvents:function(K){if(!(K||(K=D.result(this,"events")))){return}this.undelegateEvents();for(var J in K){var L=K[J];if(!D.isFunction(L)){L=this[K[J]]}if(!L){throw new Error('Method "'+K[J]+'" does not exist')}var I=J.match(g);var H=I[1],G=I[2];L=D.bind(L,this);H+=".delegateEvents"+this.cid;if(G===""){this.$el.bind(H,L)}else{this.$el.delegate(G,H,L)}}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(G){if(this.options){G=D.extend({},D.result(this,"options"),G)}D.extend(this,D.pick(G,w));this.options=G},_ensureElement:function(){if(!this.el){var G=D.extend({},D.result(this,"attributes"));if(this.id){G.id=D.result(this,"id")}if(this.className){G["class"]=D.result(this,"className")}this.setElement(this.make(D.result(this,"tagName"),G),false)}else{this.setElement(D.result(this,"el"),false)}}});var t={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};d.sync=function(G,I,O){var J=t[G];D.defaults(O||(O={}),{emulateHTTP:d.emulateHTTP,emulateJSON:d.emulateJSON});var H={type:J,dataType:"json"};if(!O.url){H.url=D.result(I,"url")||v()}if(O.data==null&&I&&(G==="create"||G==="update"||G==="patch")){H.contentType="application/json";H.data=JSON.stringify(O.attrs||I.toJSON(O))}if(O.emulateJSON){H.contentType="application/x-www-form-urlencoded";H.data=H.data?{model:H.data}:{}}if(O.emulateHTTP&&(J==="PUT"||J==="DELETE"||J==="PATCH")){H.type="POST";if(O.emulateJSON){H.data._method=J}var L=O.beforeSend;O.beforeSend=function(P){P.setRequestHeader("X-HTTP-Method-Override",J);if(L){return L.apply(this,arguments)}}}if(H.type!=="GET"&&!O.emulateJSON){H.processData=false}var M=O.success;O.success=function(R,P,Q){if(M){M(R,P,Q)}I.trigger("sync",I,R,O)};var K=O.error;O.error=function(R,P,Q){if(K){K(I,R,O)}I.trigger("error",I,R,O)};var N=d.ajax(D.extend(H,O));I.trigger("request",I,N,O);return N};d.ajax=function(){return d.$.ajax.apply(d.$,arguments)};var x=function(G,I){var H=this;var K;if(G&&D.has(G,"constructor")){K=G.constructor}else{K=function(){H.apply(this,arguments)}}D.extend(K,H,I);var J=function(){this.constructor=K};J.prototype=H.prototype;K.prototype=new J;if(G){D.extend(K.prototype,G)}K.__super__=H.prototype;return K};n.extend=E.extend=C.extend=u.extend=b.extend=x;var v=function(){throw new Error('A "url" property or function must be specified')}}).call(this);